<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width; initial-scale=1.0">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Vichrome 0.4.1リリースしたので紹介</title>

    <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml">
    <link href="/favicon.png" rel="icon" type="image/png">
    <link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script>
    <script src="/javascripts/modernizr-2.0.js"></script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-26982762-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="blog blog_2011 blog_2011_10 blog_2011_10_11 blog_2011_10_11_vichrome-0-4-1">
  <header>
    <hgroup>
      <a href="/"><h1 class="title">K2NR.ME</h1></a>
    </hgroup>
  </header>
  <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja">Tweet</a>
    <article>
    <header>
      <h1>Vichrome 0.4.1リリースしたので紹介</h1>
      <time datetime="2011-10-11" pubdate>Oct 11, 2011</time>
    </header>
    <p><img src="http://3.bp.blogspot.com/-znVUKjoHsnw/ToMAQ9EvSTI/AAAAAAAAAHE/2yH3d7trWhg/s1600/128.png %}" /></p>

<p>つーかリリースしたのは一昨日だけども。</p>

<p>Vichromeはvi(vim)風のキー操作を実現するGoogle Chrome Extensionです。</p>

<p>前回の記事：<a href="/blog/2011/09/28/vichrome-vim-chrome-extension/">Vichrome : vim風インタフェースを実現するChrome Extension</a></p>

<p>最初のバージョン0.1をリリースしてから約２週間くらい？気がつくともうバージョン0.4になってたので、新規追加した機能を紹介。
バグ修正中心だったから大した量ではない。</p>

<h2 id="lt-nop-gt">&lt;NOP&gt;</h2>

<p>実装するのを忘れてたので急遽0.2で実装。
Vichromeのキーバインドを無効化するだけです。</p>
<pre class="highlight plaintext"><code>nmap &lt;C-f&gt; &lt;NOP&gt;
</code></pre>

<p>重要なのは、Vichromeのキーバインドを無効化することで既存の（Chromeの、あるいは特定のWebページだけで有効な）キーバインドが有効になることです。
上の例だとPageDownが無効になる代わりにChromeのデフォルトの検索が有効になります。（Macは違うよ。&lt;M-f&gt;だから。）</p>

<h2 id="opennewwindow">:OpenNewWindow</h2>

<p>個人的にはそれ程需要があるとは思えないですが、一応実装しました。基本的に僕は１つのウィンドウにタブをいっぱい開くので（みんなそうだよね？）。
このコマンドで少し珍しいのは&ndash;popオプション。
今開いてるページのタブを新しいウィンドウに移動させます。
特に意味もなくデフォルトでgpにキーバインドを割り当ててみましたwww使わないのにwww
元のウィンドウからポンっと飛び出すイメージだから&ndash;popオプションwwwまあ僕は使わないけどwww</p>

<h2 id="opennewtabの新オプション">:OpenNewTabの新オプション</h2>

<p>僕が最も多用するコマンドなので、いくつか新しいオプションを追加しました。</p>
<pre class="highlight plaintext"><code>--background : 新しいタブをバックグラウンドで開く
--pinned : 新しいタブをピン状態で開く
</code></pre>

<p>これに加えて、:OpenNewTabコマンドが複数のURLを扱えるようにしました。</p>
<pre class="highlight plaintext"><code>:OpenNewTab --background https://mail.google.com/mail https://twitter.com/
</code></pre>

<p>みたいに。Chrome起動時にいつも開くページが決まってる人は立ち上げコマンドとしてAliasしておくと便利かもしれません。</p>

<h2 id="alias">:Alias</h2>

<p>動的にエイリアス設定を変えようと思う人はあまりいないかもしれませんが、ないよりはましだろうということで。使い方はオプションページに書くのと同じです。最初が大文字なこと以外は。</p>

<h2 id="pagecmd">pagecmd</h2>

<p>ここまではおまけ。ここからが本番。pagecmdは超絶便利です。これは指定したURLのページだけで有効になるnmap/imap/aliasを定義することができます。オプションページのキーマップ設定で使えます。文法は</p>
<pre class="highlight plaintext"><code>pagecmd [target url] [nmap/imap/alias] [argumets] ...
</code></pre>

<p>target urlには有効になるウェブページを指定します。Ignored URLsと同様にワイルドカードが使えます。
以降は通常のnmap/imap/aliasと同じ。特定のページだけ有効にしたいキーバインドというのはあまりないかもしれないですが、特定のページだけ無効にしたいキーバインドというのは結構あります。
そのページ自体が便利なキーバインドを持ってる場合ですね。例えば</p>
<pre class="highlight plaintext"><code>pagecmd http*://twitter.com* nmap f &lt;NOP&gt;
pagecmd http*://twitter.com* nmap r &lt;NOP&gt;
</code></pre>

<p>twitterのwebってたくさんキーバインドがあるんです。上の例はその一部でfがfavorite、rがreplyです。
fとrのVicromeキーバインドをtwitterでは無効化することで、これらのvery usefulなコマンドが使えるようになります。</p>

<p>もう一つ重要な点として、pagecmdはIgnored URLsよりも優先度を高く実装しています。なので、Ignored URLsに</p>
<pre class="highlight plaintext"><code>http*://www.google.co*/reader/*
</code></pre>

<p>と追加しても、pagecmdで</p>
<pre class="highlight plaintext"><code>pagecmd * nmap &lt;C-l&gt; :MoveToNextTab
pagecmd * nmap &lt;C-h&gt; :MoveToPrevTab
</code></pre>

<p>これで、すべてのサイトでタブ移動のキーが有効になります。
Ignored URLsが実はIgnoredじゃないって仕様的にどうよっていう葛藤はありましたが、現実問題として<strong>特定のサイトで特定のキーだけ</strong>有効にさせる機能を実現するにはこれが最もシンプルという結論に至りました。</p>

<h2 id="golinktextsearchmode">:GoLinkTextSearchMode</h2>

<p>最新0.4.0で追加したコマンド。意外と便利。
リンク内のテキストだけ検索するモードです。
それ以外の動作は全て通常検索を踏襲しています。
ヒットした検索結果には自動でフォーカスが当たるのでエンターキーを押すだけでリンクが開けます。</p>

<p>f-Mode(HIT-A-HINT)があればいらないんじゃんないか、と実装する前は思ってましたが、f-Modeとは少し目的が違うということが使ってみてはじめてわかりました。
f-Modeを使用するときはオープンしたいリンクが明確に決まってます。
「今から俺はこれを開くぞ」というときはf-Modeが最適でしょう。
LinkTextSearchModeはむしろ「あれ、このページからあのページにリンクあったよな。。」
みたいなアバウトな情報からリンクを探すときに非常に便利です。</p>

<p>このコマンドはデフォルトで&#39;a&#39;キーにバインドしました。もちろんHTMLの&lt;a&gt;タグが語源です。</p>

<p>以上。</p>

<p>ちなみに既知のバグでクリティカルかつ修正目処が立たないのが、</p>

<ul>
<li>GMailのページで一切Vichromeが動作できない。</li>
<li>IFrame内のコンテンツが操作（スクロール、検索、f-Mode全部）出来ない。</li>
<li>Amazonとか、一部のサイトの一部のリンクがf-Modeの候補にならない。</li>
</ul>

<p>これくらいだろうか。なんとか修正したいね。</p>

<p>これから少しの間<strong>VichromeをCoffeeScriptで作りなおそうプロジェクト</strong>が忙しいので新規機能の実装は少し先になるかもしません。</p>

  </article>
  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'k2nrme'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  <footer>
  k2nr
</footer>

  </body>
</html>
